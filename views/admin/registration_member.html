<!DOCTYPE html>
<html>
<head>
  {{template "_head" .}}

  <!-- External -->
  <link href="/static/ex/bootoast.css" rel="stylesheet" type="text/css">
  <!-- bootstrap datepicker -->
  <link rel="stylesheet" href="/static/bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

  {{template "_header" .}}

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        {{.Nav}}
      </h1>
      <ol class="breadcrumb">
        <li><a href="/dashboard/{{.Admin.Slug}}"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="/members">{{.Nav}}</a></li>
        <li class="active">Registrasi Member</li>
      </ol>
    </section>
    <!-- Main content -->
    <section class="content">
      <div class="row">
        <div class="col-md-3">
          <!-- Profile Image -->
          <div class="box box-primary">
            <div class="box-body box-profile">
              <img id="img-profile" class="profile-user-img img-responsive img-circle" src="/static/images/user/member.png">
              <h3 class="profile-username text-center">New Member</h3>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
        </div>
        <!-- /.col -->
        <div class="col-md-9">
          <div class="nav-tabs-custom" id="tabs">
            <ul class="nav nav-tabs">
              <li class="active"><a href="#tab_biodata" data-toggle="tab" id="biodata">Biodata</a></li>
              <li><a href="#tab_latar" data-toggle="tab" id="latar">Latar</a></li>
              <li><a href="#tab_kerabat" data-toggle="tab" id="kerabat">Kerabat</a></li>
              <li><a href="#tab_data" data-toggle="tab" id="data">Data</a></li>
              <li><a href="#tab_foto" data-toggle="tab" id="foto">Foto</a></li>
            </ul>
            <div class="tab-content">
              <div class="active tab-pane" id="tab_biodata">
                <form class="form-horizontal">
                  <div class="form-group">
                    <label for="inputName" class="col-sm-2 control-label">Nama *</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="nama">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputName" class="col-sm-2 control-label">Email *</label>
                    <div class="col-sm-10">
                      <label id="invalid" class="control-label text-red error" hidden><i class="fa fa-times-circle-o text-red"></i> Please enter a valid email address</label>
                      <label id="unavailable" class="control-label text-red error" hidden><i class="fa fa-times-circle-o text-red"></i> Email has already been taken</label>
                      <label id="succes" class="control-label text-green" hidden><i class="fa fa-check text-green"></i> Email is valid</label>
                      <input type="email" class="form-control" id="email">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputEmail" class="col-sm-2 control-label">No HP *</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="no_hp">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputName" class="col-sm-2 control-label">No Identitas *</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="nik">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputExperience" class="col-sm-2 control-label">Tgl Lahir *</label>
                    <div class="col-sm-10">
                      <div class="input-group date">
                        <div class="input-group-addon">
                          <i class="fa fa-calendar"></i>
                        </div>
                        <input type="text" id="datepicker" class="form-control pull-right" required>
                      </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputSkills" class="col-sm-2 control-label">Alamat *</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="alamat">
                    </div>
                  </div>
                  <div align="center">
                    <button type="button" class="btn btn-info" onclick="changeToTab('biodata',1,'latar')">Next</button>
                  </div>
                </form>
              </div>
              <!-- /.tab-pane -->
              <div class="tab-pane" id="tab_latar">
                <form class="form-horizontal">
                  <div class="form-group">
                    <label for="inputName" class="col-sm-2 control-label">Pekerjaan *</label>
                    <div class="col-sm-10">
                      <select class="form-control" id="pekerjaan">
                        <option value="">Pilih Pekerjaan</option>
                        <option value="Mahasiswi">Mahasiswi</option>
                        <option value="Karyawati">Karyawati</option>
                        <option>Lainnya</option>
                      </select>
                    </div>
                  </div>
                  <div id="mahasiswi" class="pekerjaan" hidden>
                    <div class="form-group">
                      <label for="inputEmail" class="col-sm-2 control-label">Kampus *</label>
                      <div class="col-sm-10">
                        <input type="text" class="form-control" id="kampus">
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="inputName" class="col-sm-2 control-label">Jurusan *</label>
                      <div class="col-sm-10">
                        <input type="text" class="form-control" id="jurusan">
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="inputExperience" class="col-sm-2 control-label">Angkatan *</label>
                      <div class="col-sm-10">
                        <input class="form-control" id="angkatan">
                      </div>
                    </div>
                  </div>
                  <div id="karyawati" class="pekerjaan" hidden>
                    <div class="form-group">
                      <label for="inputName" class="col-sm-2 control-label">Kantor *</label>
                      <div class="col-sm-10">
                        <input type="text" class="form-control" id="kantor">
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="inputExperience" class="col-sm-2 control-label">Alamat *</label>
                      <div class="col-sm-10">
                        <input class="form-control" id="alamat_kantor">
                      </div>
                    </div>
                  </div>
                  <div id="lainnya" class="pekerjaan" hidden>
                    <div class="form-group">
                      <label for="inputName" class="col-sm-2 control-label"></label>
                      <div class="col-sm-10">
                        <input type="text" class="form-control" id="lainnya">
                      </div>
                    </div>
                  </div>
                  <div align="center">
                    <button type="button" class="btn btn-default" onclick="changeToTab('', 0, 'biodata')">Previous</button>
                    <button type="button" class="btn btn-info" onclick="changeToTab('latar', 2, 'kerabat')">Next</button>
                  </div>
                </form>
              </div>
              <!-- /.tab-pane -->
              <div class="tab-pane" id="tab_kerabat">
                <form class="form-horizontal">
                  <div class="form-group">
                    <label for="inputName" class="col-sm-2 control-label">Nama Kerabat *</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="nk1">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputEmail" class="col-sm-2 control-label">Hubungan *</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="hb1">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputName" class="col-sm-2 control-label">No HP *</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="no_hp1">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputName" class="col-sm-2 control-label">Nama Kerabat 2</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="nk2">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputEmail" class="col-sm-2 control-label">Hubungan</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="hb2">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputName" class="col-sm-2 control-label">No HP</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="no_hp2">
                    </div>
                  </div>
                  <div align="center">
                    <button type="button" class="btn btn-default" onclick="changeToTab('', 1, 'latar')">Previous</button>
                    <button type="button" class="btn btn-info" onclick="changeToTab('kerabat', 3, 'data')">Next</button>
                  </div>
                </form>
              </div>
              <!-- /.tab-pane -->
              <div class="tab-pane" id="tab_data">
                <form class="form-horizontal">
                  <div class="form-group">
                    <label for="inputName" class="col-sm-2 control-label">Lokasi Kos *</label>
                    <div class="col-sm-10">
                      <select class="form-control" name="lokasi" id="lokasi">
                        <option value="">Pilih Lokasi *</option>
                        {{range .Lokasi.Lokasi}}
                        <option value="{{.Id_lokasi}}"><b>{{.Cabang}}</b> - {{.Alamat}}</option>
                        {{end}}
                      </select>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputName" class="col-sm-2 control-label">Pembayaran *</label>
                    <div class="col-sm-10">
                      <select class="form-control" id="pembayaran">
                        <option value="">Pilih Pembayaran</option>
                        <option value="Harian">Harian</option>
                        <option value="Mingguan">Mingguan</option>
                        <option value="Bulanan">Bulanan</option>
                        <option value="Tahunan">Tahunan</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputName" class="col-sm-2 control-label">No Kamar *</label>
                    <div class="col-sm-10">
                      <select class="form-control" name="kamar" id="kamar">
                        <option>Pilih kamar</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputName" class="col-sm-2 control-label">Uname Wifi</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="uname">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputEmail" class="col-sm-2 control-label">No STNK</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="stnk">
                    </div>
                  </div>
                  <div align="center">
                    <button type="button" class="btn btn-default" onclick="changeToTab('', 2, 'kerabat')">Previous</button>
                    <button type="button" class="btn btn-info" onclick="changeToTab('data', 4, 'foto')">Next</button>
                  </div>
                </form>
              </div>
              <!-- /.tab-pane -->
              <div class="tab-pane" id="tab_foto">
                <form class="form-horizontal" action="/ganti-foto" enctype="multipart/form-data" method="POST">
                  <div class="form-group">
                    <div class="col-sm-10">
                      <div class="btn btn-default">
                        <!-- <i class="fa fa-paperclip"></i> Attachment -->
                        <input type="file" id="file" name="file">
                      </div>
                      <button type="reset" class="btn btn-default"><i class="fa fa-times"></i></button>
                      <p class="help-block">Max. 1MB</p>
                    </div>
                  </div>
                  <div align="center">
                    <button type="button" class="btn btn-default" onclick="changeToTab('', 3, 'foto')">Previous</button>
                    <p class="btn btn-success" id="register">Register</p>
                  </div>
                </form>
              </div>
              <!-- /.tab-pane -->
            </div>
            <!-- /.tab-content -->
          </div>
          <!-- /.nav-tabs-custom -->
        </div>
        <!-- /.col -->
      </div>
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  {{template "_footer" .}}

  <!-- External -->
  <script src="/static/ex/bootoast.min.js"></script>
  <!-- jQuery UI 1.11.4 -->
  <script src="/static/bower_components/jquery-ui/jquery-ui.min.js"></script>
  <!-- bootstrap datepicker -->
  <script src="/static/bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>

<script>
  function ok(tabIndex, nextTab) {
    $('#'+nextTab).trigger('click');
    $("#tabs").tabs();
    $("#tabs").tabs("option","active", tabIndex);
  }

  function changeToTab(tabName, tabIndex, nextTab){
    switch (tabName) {
      case "biodata":
        var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        var nama = $("#nama").val();
        var email = $("#email").val();
        var no_hp = $("#no_hp").val();
        var nik = $("#nik").val();
        var tgl_lahir = $("#datepicker").val();
        var alamat = $("#alamat").val();

        if (nama == '' || no_hp == '' || nik == '' || tgl_lahir == '' || alamat == '') {
          bootoast.toast({
            message: "Silahkan lengkapi form dahulud.",
            type: 'warning'
          });
          break;
        } else if ($(".error").is(":visible")) {
          bootoast.toast({
            message: "Please fix your email.",
            type: 'warning'
          });
          break;
        }
        ok(tabIndex, nextTab);
        break;
      case "latar":
        pekerjaan = $("#pekerjaan").val();
        if (pekerjaan == '') {
          bootoast.toast({
            message: "Silahkan lengkapi form dahulux.",
            type: 'warning'
          });
          break;
        }
        ok(tabIndex, nextTab);
        break;

      case "kerabat":
        nk1 = $("#nk1").val();
        hb1 = $("#hb1").val();
        no_hp1 = $("#no_hp1").val();

        if (nk1 == '' || hb1 == '' || no_hp1 == '') {
          bootoast.toast({
            message: "Silahkan lengkapi form dahuluz.",
            type: 'warning'
          });
          break;
        }
        ok(tabIndex, nextTab);
        break;

      case "data":
        lokasi = $("#lokasi").val();
        pembayaran = $("#pembayaran").val();
        kamar = $("#kamar").val();

        if (lokasi == '' || pembayaran == '' || kamar == '') {
          bootoast.toast({
            message: "Silahkan lengkapi form dahulub.",
            type: 'warning'
          });
          break;
        }
        ok(tabIndex, nextTab);
        break;

      default:
        $('#'+nextTab).trigger('click');
        $("#tabs").tabs();
        $("#tabs").tabs("option","active", tabIndex);

    }
  }

  $(document).ready(function(){
    $('#datepicker').datepicker({
      format: "dd/mm/yyyy",
      autoclose: true
    });

    $('#email').keyup(function(){
      var email = $("#email").val();
      var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

      if (!regex.test(email)) {
        $('#invalid').show();
        $('#succes').hide();
        $('#unavailable').hide();
      } else {
        $.ajax({
          url:"/admin/check-email-member",
          type : 'POST',
          data : {'email':email},
          success:function(response){
            if (response == "true") {
              $('#succes').show();
              $('.error').hide();
            } else {
              $('#unavailable').show();
              $('#succes').hide();
              $('#invalid').hide();
            }
          },
          error:function(error){
            $('#succes').hide();
            $('.error').show();
          }
        });
      }
    });

    $('#pekerjaan').change(function() {
      var pekerjaan = $("#pekerjaan").val();
      if (pekerjaan == "Mahasiswi") {
        $(".pekerjaan").hide();
        $("#mahasiswi").show();
      } else if (pekerjaan == "Karyawati") {
        $(".pekerjaan").hide();
        $("#karyawati").show();
      } else if (pekerjaan == "Lainnya") {
        $(".pekerjaan").hide();
        $("#lainnya").show();
      } else {
        $(".pekerjaan").hide();
      }
    });

    // load_json_data('lokasi');
    function load_json_data(id, id_lokasi) {
      var html_code = '';

        // $.ajax({
        //   dataType: "json",
        //   url: "/getJson",
        //   success: function(response){
        //     console.log(response);
        //     html_code += '<option value="">Pilih '+id+'</option>';
        //       $.each(response.kamar, function(i, value) {
        //         if(id == 'lokasi'){
        //           if(value.id_lokasi == '0') {
        //             html_code += '<option value="'+value.id_kamar+'">'+value.no_kamar+'</option>';
        //           }
        //         }
        //         else {
        //           if(value.id_lokasi == id_lokasi && value.status_kamar == "Tersedia") {
        //             html_code += '<option value="'+value.id_kamar+'">'+value.no_kamar+'</option>';
        //           }
        //         }
        //       });
        //       $('#'+id).html(html_code);
        //   },
        //   error:function(error){
        //     console.log(error);
        //   }
        // });
      $.getJSON("/getKamarJson", function(response) {
        console.log(response);
        html_code += '<option value="">Pilih '+id+'</option>';
        $.each(response.kamar, function(key, value) {
          if(id == 'lokasi'){
            if(value.id_lokasi == '0') {
              html_code += '<option value="'+value.no_kamar+'">'+value.no_kamar+'</option>';
            }
          }
          else {
            if(value.id_lokasi == id_lokasi && value.status_kamar == "Tersedia") {
              html_code += '<option value="'+value.no_kamar+'">'+value.no_kamar+'</option>';
            }
          }
        });
        $('#'+id).html(html_code);
      });
      // .done(function() {
      //   console.log( "second success" );
      // }).fail(function(err) {
      //   console.log("error");
      // }).always(function() {
      //   console.log( "complete" );
      // });
    }

    $('#lokasi').change(function(){
      var id_lokasi = $(this).val();
      if(id_lokasi != '') {
        load_json_data('kamar', id_lokasi);
      }
      else {
        $('#kamar').html('<option value="">Pilih kamar</option>');
      }
    });

    $('#register').on("click", function(e) {
      e.preventDefault();
      var tgl_lahir = $("#datepicker").val();
      var d = tgl_lahir.substr(0,2);
      var m = tgl_lahir.substr(3,2);
      var y = tgl_lahir.substr(6,4);
      var custTgl_lahir = y.concat("-", m, "-", d);

      var data  =  JSON.stringify({
        nama : $("#nama").val(), email : $("#email").val(), no_hp : $("#no_hp").val(), nik : $("#nik").val(), custTgl_lahir, alamat_asal : $("#alamat").val(),
        pekerjaan : $("#pekerjaan").val(),
        universitas : $("#kampus").val(), jurusan : $("#jurusan").val(), angkatan : $("#angkatan").val(),
        perusahaan : $("#kantor").val(), jabatan : $("#alamat_kantor").val(), // lainnya : $("#lainnya").val(),
        nama_kerabat1 : $("#nk1").val(), hubungan1 : $("#hb1").val(), no_hp1 : $("#no_hp1").val(),
        nama_kerabat2 : $("#nk2").val(), hubungan2 : $("#hb2").val(), no_hp2 : $("#no_hp2").val(),
        id_lokasi : parseInt($("#lokasi").val()), tipe_pembayaran : $("#pembayaran").val(), no_kamar : $("#kamar").val(),
        username_wifi : $("#uname").val(), no_stnk : $("#stnk").val()
      });

      $.ajax({
        url:"/admin/create-member",
        type : 'POST',
        data : data,
        contentType: 'application/json',
        success:function(response){
          if (response == "true") {
            bootoast.toast({
              message: "Biodata berhasil di edit.",
              type: 'success'
            });
            setTimeout(function () {
  						location.reload();
  					}, 1500);
          } else {
            //  error message
          }
        },
        error:function(error){
          $('#succes').hide();
          $('#error').show();
        }
      });

    });

  });
</script>
  </body>
  </html>
